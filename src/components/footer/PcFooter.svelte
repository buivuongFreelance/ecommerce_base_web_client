<script>
	import { _ } from 'svelte-i18n';
	import LazyLoad from 'vanilla-lazyload';
	import LazyImage from '../image/LazyImage.svelte';
	import { onDestroy, onMount } from 'svelte';
	import { category, linkToBack } from '../../stores';
	import ContentLoader from 'svelte-content-loader';
	import { listBrand as apiListBrand } from '../../services/model';
	import { stores, goto } from '@sapper/app';

	let isLoadingBrand = false;
	let isServerBrand = false;
	let brands = [];

	let observer;
	let containerEle;
	let visible = false;

	const { session, page } = stores();
	const { domainModel } = $session;

	onMount(async () => {
		brands = await listBrand();

		setTimeout(() => {
			if (containerEle) {
				observer = new LazyLoad({
					container: containerEle,
					elements_selector: '.lazy-bg',
					callback_finish: finishBackground,
				});
				if (typeof observer.update === 'function') {
					observer.update();
				}
			}
		}, 500);
	});

	onDestroy(() => {
		if (observer) {
			if (typeof observer.destroy === 'function') {
				observer.destroy();
			}
		}
	});

	const finishBackground = () => {
		visible = true;
	};

	const listBrand = () => {
		isLoadingBrand = true;
		return new Promise((resolve, reject) => {
			apiListBrand(domainModel)
				.then((list) => {
					isLoadingBrand = false;
					isServerBrand = false;
					resolve(list);
				})
				.catch((error) => {
					isServerBrand = true;
					isLoadingBrand = false;
					reject(error);
				});
		});
	};
	const handleCategory = async (brand) => {
		const brands = [brand.id];
		category.set({
			brands,
		});
		linkToBack.set('category');
		await goto('empty');
	};
	const handleCategoryEmpty = () => {
		category.set(null);
		linkToBack.set('category');
		goto('empty');
	};
</script>

<div
	bind:this={containerEle}
	class={visible ? 'o-100 mw-full' : 'o-0'}
	class:mt-30={$page.path === '/'}
>
	<div class="footer pv6 lazy-bg" data-bg="images/bg-footer.png">
		<div class="mw10 center tc">
			<div>
				<a href="/">
					<h2>Logo</h2>
				</a>
				<!-- <a href="/"><img
						src="images/com_logo_white.png"
						alt="dingtoi"
						class="logo" /></a> -->
			</div>
			<div class="flex justify-center ttu mt5">
				<a class="fw6 white link dim pr4" href="/">{$_('nav.home')}</a>

				{#if isServerBrand}
					<p class="red f5">{$_('error.serverErrorMessage')}</p>
				{:else if isLoadingBrand}
					<ContentLoader
						uniqueKey="footer"
						primaryColor="#e4e6ef"
						secondaryColor="#f8f8f8"
						width={270}
						height="30"
					>
						<rect x="0" y="0" rx="3" ry="3" width="100" height="30" />
						<rect x="110" y="0" rx="3" ry="3" width="100" height="30" />
					</ContentLoader>
				{:else if brands.length > 0}
					{#each brands as brand}
						<div
							class="fw6 white link dim ph4 pointer"
							on:click={() => handleCategory(brand)}
						>
							{brand.name}
						</div>
					{/each}
				{/if}
				<div
					class="fw6 white link dim ph4 pointer"
					on:click={() => handleCategoryEmpty()}
				>
					{$_('nav.otherSmartPhones')}
				</div>
				<a href="/privacy" class="fw6 white link dim ph4 pointer">
					{$_('checkout.privacy')}
				</a>
			</div>
			<div class="socials flex justify-center">
				<a
					href="https://www.facebook.com/dingtoicorp/"
					target="_blank"
					class="social mr4"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						xmlns:xlink="http://www.w3.org/1999/xlink"
						width="50pt"
						height="50pt"
						viewBox="0 0 50 50"
						version="1.1"
					>
						<g id="surface8660432">
							<path
								style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;"
								d="M 25 3 C 12.863281 3 3 12.863281 3 25 C 3 36.019531 11.128906 45.136719 21.714844 46.730469 L 22.863281 46.902344 L 22.863281 29.566406 L 17.664062 29.566406 L 17.664062 26.046875 L 22.863281 26.046875 L 22.863281 21.371094 C 22.863281 18.496094 23.550781 16.597656 24.695312 15.410156 C 25.839844 14.222656 27.527344 13.621094 29.878906 13.621094 C 31.757812 13.621094 32.488281 13.734375 33.183594 13.820312 L 33.183594 16.699219 L 30.738281 16.699219 C 29.351562 16.699219 28.210938 17.476562 27.617188 18.507812 C 27.027344 19.539062 26.84375 20.773438 26.84375 22.027344 L 26.84375 26.042969 L 32.964844 26.042969 L 32.421875 29.566406 L 26.84375 29.566406 L 26.84375 46.929688 L 27.976562 46.777344 C 38.714844 45.320312 47 36.125 47 25 C 47 12.863281 37.136719 3 25 3 Z M 25 5 C 36.058594 5 45 13.941406 45 25 C 45 34.730469 38.035156 42.730469 28.84375 44.535156 L 28.84375 31.566406 L 34.136719 31.566406 L 35.296875 24.042969 L 28.84375 24.042969 L 28.84375 22.027344 C 28.84375 20.988281 29.035156 20.058594 29.351562 19.5 C 29.671875 18.945312 29.980469 18.699219 30.738281 18.699219 L 35.183594 18.699219 L 35.183594 12.007812 L 34.316406 11.890625 C 33.71875 11.8125 32.347656 11.621094 29.878906 11.621094 C 27.175781 11.621094 24.855469 12.359375 23.253906 14.023438 C 21.652344 15.6875 20.859375 18.171875 20.859375 21.371094 L 20.859375 24.046875 L 15.664062 24.046875 L 15.664062 31.566406 L 20.859375 31.566406 L 20.859375 44.46875 C 11.816406 42.554688 5 34.625 5 25 C 5 13.941406 13.941406 5 25 5 Z M 25 5 "
							/>
						</g>
					</svg>
				</a>
				<a
					href="https://www.instagram.com/dingtoicorp/"
					target="_blank"
					class="social mr4"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						xmlns:xlink="http://www.w3.org/1999/xlink"
						width="50pt"
						height="50pt"
						viewBox="0 0 50 50"
						version="1.1"
					>
						<g id="surface8853754">
							<path
								style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;"
								d="M 16 3 C 8.832031 3 3 8.832031 3 16 L 3 34 C 3 41.167969 8.832031 47 16 47 L 34 47 C 41.167969 47 47 41.167969 47 34 L 47 16 C 47 8.832031 41.167969 3 34 3 Z M 16 5 L 34 5 C 40.085938 5 45 9.914062 45 16 L 45 34 C 45 40.085938 40.085938 45 34 45 L 16 45 C 9.914062 45 5 40.085938 5 34 L 5 16 C 5 9.914062 9.914062 5 16 5 Z M 37 11 C 35.894531 11 35 11.894531 35 13 C 35 14.105469 35.894531 15 37 15 C 38.105469 15 39 14.105469 39 13 C 39 11.894531 38.105469 11 37 11 Z M 25 14 C 18.9375 14 14 18.9375 14 25 C 14 31.0625 18.9375 36 25 36 C 31.0625 36 36 31.0625 36 25 C 36 18.9375 31.0625 14 25 14 Z M 25 16 C 29.980469 16 34 20.019531 34 25 C 34 29.980469 29.980469 34 25 34 C 20.019531 34 16 29.980469 16 25 C 16 20.019531 20.019531 16 25 16 Z M 25 16 "
							/>
						</g>
					</svg></a
				>
				<a
					href="https://twitter.com/dingtoicorp"
					class="social mr4"
					target="_blank"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						xmlns:xlink="http://www.w3.org/1999/xlink"
						width="50pt"
						height="50pt"
						viewBox="0 0 50 50"
						version="1.1"
					>
						<g id="surface18127433">
							<path
								style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;"
								d="M 34.21875 5.46875 C 28.238281 5.46875 23.375 10.332031 23.375 16.3125 C 23.375 16.671875 23.464844 17.023438 23.5 17.375 C 16.105469 16.667969 9.566406 13.105469 5.125 7.65625 C 4.917969 7.394531 4.597656 7.253906 4.261719 7.277344 C 3.929688 7.300781 3.632812 7.492188 3.46875 7.78125 C 2.535156 9.386719 2 11.234375 2 13.21875 C 2 15.621094 2.859375 17.820312 4.1875 19.625 C 3.929688 19.511719 3.648438 19.449219 3.40625 19.3125 C 3.097656 19.148438 2.726562 19.15625 2.425781 19.335938 C 2.125 19.515625 1.941406 19.839844 1.9375 20.1875 L 1.9375 20.3125 C 1.9375 23.996094 3.84375 27.195312 6.65625 29.15625 C 6.625 29.152344 6.59375 29.164062 6.5625 29.15625 C 6.21875 29.097656 5.871094 29.21875 5.640625 29.480469 C 5.410156 29.742188 5.335938 30.105469 5.4375 30.4375 C 6.554688 33.910156 9.40625 36.5625 12.9375 37.53125 C 10.125 39.203125 6.863281 40.1875 3.34375 40.1875 C 2.582031 40.1875 1.851562 40.148438 1.125 40.0625 C 0.65625 40 0.207031 40.273438 0.0507812 40.71875 C -0.109375 41.164062 0.0664062 41.660156 0.46875 41.90625 C 4.980469 44.800781 10.335938 46.5 16.09375 46.5 C 25.425781 46.5 32.746094 42.601562 37.65625 37.03125 C 42.566406 31.460938 45.125 24.226562 45.125 17.46875 C 45.125 17.183594 45.101562 16.90625 45.09375 16.625 C 46.925781 15.222656 48.5625 13.578125 49.84375 11.65625 C 50.097656 11.285156 50.070312 10.789062 49.777344 10.445312 C 49.488281 10.101562 49 9.996094 48.59375 10.1875 C 48.078125 10.417969 47.476562 10.441406 46.9375 10.625 C 47.648438 9.675781 48.257812 8.652344 48.625 7.5 C 48.75 7.105469 48.613281 6.671875 48.289062 6.414062 C 47.964844 6.160156 47.511719 6.128906 47.15625 6.34375 C 45.449219 7.355469 43.558594 8.066406 41.5625 8.5 C 39.625 6.6875 37.074219 5.46875 34.21875 5.46875 Z M 34.21875 7.46875 C 36.769531 7.46875 39.074219 8.558594 40.6875 10.28125 C 40.929688 10.53125 41.285156 10.636719 41.625 10.5625 C 42.929688 10.304688 44.167969 9.925781 45.375 9.4375 C 44.679688 10.375 43.820312 11.175781 42.8125 11.78125 C 42.355469 12.003906 42.140625 12.53125 42.308594 13.011719 C 42.472656 13.488281 42.972656 13.765625 43.46875 13.65625 C 44.46875 13.535156 45.359375 13.128906 46.3125 12.875 C 45.457031 13.800781 44.519531 14.636719 43.5 15.375 C 43.222656 15.578125 43.070312 15.90625 43.09375 16.25 C 43.109375 16.65625 43.125 17.058594 43.125 17.46875 C 43.125 23.71875 40.726562 30.503906 36.15625 35.6875 C 31.585938 40.871094 24.875 44.5 16.09375 44.5 C 12.105469 44.5 8.339844 43.617188 4.9375 42.0625 C 9.15625 41.738281 13.046875 40.246094 16.1875 37.78125 C 16.515625 37.519531 16.644531 37.082031 16.511719 36.683594 C 16.378906 36.285156 16.011719 36.011719 15.59375 36 C 12.296875 35.941406 9.535156 34.023438 8.0625 31.3125 C 8.117188 31.3125 8.164062 31.3125 8.21875 31.3125 C 9.207031 31.3125 10.183594 31.1875 11.09375 30.9375 C 11.53125 30.808594 11.832031 30.402344 11.816406 29.945312 C 11.800781 29.488281 11.476562 29.097656 11.03125 29 C 7.472656 28.28125 4.804688 25.382812 4.1875 21.78125 C 5.195312 22.128906 6.226562 22.402344 7.34375 22.4375 C 7.800781 22.464844 8.214844 22.179688 8.355469 21.746094 C 8.496094 21.3125 8.324219 20.835938 7.9375 20.59375 C 5.5625 19.003906 4 16.296875 4 13.21875 C 4 12.078125 4.296875 11.03125 4.6875 10.03125 C 9.6875 15.519531 16.6875 19.164062 24.59375 19.5625 C 24.90625 19.578125 25.210938 19.449219 25.414062 19.210938 C 25.617188 18.96875 25.695312 18.648438 25.625 18.34375 C 25.472656 17.695312 25.375 17.007812 25.375 16.3125 C 25.375 11.414062 29.320312 7.46875 34.21875 7.46875 Z M 34.21875 7.46875 "
							/>
						</g>
					</svg>
				</a>
				<a
					href="https://ca.linkedin.com/in/dingtoi-corporation-2517671b3"
					target="_blank"
					class="social mr4"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						xmlns:xlink="http://www.w3.org/1999/xlink"
						width="50pt"
						height="50pt"
						viewBox="0 0 50 50"
						version="1.1"
					>
						<g id="surface18128026">
							<path
								style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;"
								d="M 8 3.011719 C 6.3125 3.011719 4.835938 3.492188 3.753906 4.363281 C 2.671875 5.238281 2.011719 6.535156 2.011719 7.945312 C 2.011719 10.691406 4.46875 12.816406 7.71875 12.941406 C 7.808594 12.972656 7.902344 12.988281 8 12.988281 C 9.753906 12.988281 11.246094 12.472656 12.3125 11.5625 C 13.378906 10.65625 13.988281 9.34375 13.988281 7.945312 C 13.988281 7.929688 13.988281 7.910156 13.988281 7.894531 C 13.832031 5.132812 11.375 3.011719 8 3.011719 Z M 8 4.988281 C 10.609375 4.988281 11.894531 6.269531 12.003906 7.972656 C 12 8.804688 11.675781 9.511719 11.03125 10.0625 C 10.378906 10.621094 9.371094 11.011719 8 11.011719 C 5.398438 11.011719 3.988281 9.597656 3.988281 7.945312 C 3.988281 7.121094 4.328125 6.441406 4.996094 5.902344 C 5.664062 5.363281 6.6875 4.988281 8 4.988281 Z M 3 15 C 2.449219 15 2 15.449219 2 16 L 2 45 C 2 45.550781 2.449219 46 3 46 L 13 46 C 13.550781 46 14 45.550781 14 45 L 14 16 C 14 15.449219 13.550781 15 13 15 Z M 18 15 C 17.449219 15 17 15.449219 17 16 L 17 45 C 17 45.550781 17.449219 46 18 46 L 28 46 C 28.550781 46 29 45.550781 29 45 L 29 28.5 C 29 26.554688 30.554688 25 32.5 25 C 34.445312 25 36 26.554688 36 28.5 L 36 45 C 36 45.550781 36.449219 46 37 46 L 47 46 C 47.550781 46 48 45.550781 48 45 L 48 28 C 48 23.875 46.789062 20.605469 44.746094 18.375 C 42.699219 16.144531 39.847656 15 36.789062 15 C 32.882812 15 30.523438 16.425781 29 17.601562 L 29 16 C 29 15.449219 28.550781 15 28 15 Z M 4 17 L 12 17 L 12 44 L 4 44 Z M 19 17 L 27 17 L 27 19.636719 C 27 20.054688 27.253906 20.425781 27.640625 20.574219 C 28.027344 20.71875 28.46875 20.613281 28.742188 20.308594 C 28.742188 20.308594 31.710938 17 36.785156 17 C 39.359375 17 41.617188 17.921875 43.269531 19.726562 C 44.921875 21.53125 46 24.261719 46 28 L 46 44 L 38 44 L 38 28.5 C 38 28.359375 37.972656 28.21875 37.914062 28.089844 C 37.695312 25.265625 35.378906 23 32.5 23 C 29.472656 23 27 25.472656 27 28.5 L 27 44 L 19 44 Z M 19 17 "
							/>
						</g>
					</svg>
				</a>
			</div>
			<div class="flex justify-center mb5">
				<div class="">
					<LazyImage
						src="images/pay_paypal.png"
						alt="paypal"
						width="48px"
						height="30px"
					/>
				</div>
				<div class="mh3">
					<LazyImage
						src="images/card_master.png"
						alt="paypal"
						width="48px"
						height="30px"
					/>
				</div>
				<div class="">
					<LazyImage
						src="images/card_visa.png"
						alt="paypal"
						width="48px"
						height="30px"
					/>
				</div>
			</div>
			<div class="text-stroke">Tomrot Corporation 2022.</div>
		</div>
	</div>
</div>

<style>
	/* .logo {
		width: 200px;
	} */
	.text-stroke {
		-webkit-text-stroke: 1px #fff;
	}
	.social svg {
		width: 24px;
	}
	.footer {
		background-size: cover;
	}
	.mt-30 {
		margin-top: -30px;
	}
</style>
